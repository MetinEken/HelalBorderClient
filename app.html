<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Ai Project</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Çevre değişkenleri ve giriş kontrolü için gerekli dosyalar -->
    <script src="env.js"></script>
    <script src="auth.js"></script>
    <!-- Material UI CSS ve JS dosyaları -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <style>
      body {
        font-family: "Roboto", "Segoe UI", sans-serif;
        background-color: #f2f4f8;
        margin: 0;
        padding: 0;
        overflow-y: auto;
      }

      .header {
        background-color: #007bff;
        color: white;
        padding: 1rem 2rem;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .logout-button {
        position: absolute;
        right: 2rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        font-size: 0.9rem;
      }

      .logout-button:hover {
        text-decoration: underline;
      }

      .tab-container {
        width: calc(100% - 100px);
        max-width: calc(100% - 100px);
        margin: 2rem auto;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        padding: 0 50px;
      }

      .tabs {
        display: flex;
        background-color: #f5f5f5;
        border-bottom: 1px solid #ddd;
      }

      .tab {
        padding: 1rem 1.5rem;
        cursor: pointer;
        transition: background-color 0.3s;
        font-weight: 500;
        text-align: center;
        flex: 1;
      }

      .tab:hover {
        background-color: #e0e0e0;
      }

      .tab.active {
        background-color: #fff;
        border-bottom: 3px solid #007bff;
        color: #007bff;
      }

      .tab-content {
        display: none;
        padding: 2rem 0;
        max-height: calc(100vh - 180px);
        overflow-y: auto;
        width: 100%;
      }

      .tab-content.active {
        display: block;
      }

      /* Yapay Zeka Kelimeleri Tab Stilleri */
      .container {
        max-width: 800px;
        margin: auto;
        background-color: #fff;
        padding: 2rem;
        border-radius: 8px;
      }

      h1,
      h2 {
        text-align: center;
        color: #333;
        margin-bottom: 1.5rem;
      }

      label {
        display: block;
        margin-top: 1.5rem;
        font-weight: 600;
        color: #333;
      }

      textarea {
        width: 100%;
        padding: 0.75rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        resize: vertical;
        min-height: 30rem;
      }

      button {
        margin-top: 2rem;
        width: 100%;
        padding: 1rem;
        background-color: #007bff;
        color: white;
        font-size: 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      button:hover {
        background-color: #0056b3;
      }

      #response {
        margin-top: 1.5rem;
        background-color: #f8f9fa;
        border-left: 4px solid #28a745;
        padding: 1rem;
        white-space: pre-wrap;
      }

      .empty-tab {
        text-align: center;
        padding: 3rem;
        color: #666;
      }

      /* Barcode Kelimeler bölümü için stiller */
      .barcode-container {
        width: 100%;
        max-width: 100%;
        margin: 0;
        padding: 0;
      }

      .barcode-container h2 {
        text-align: center;
        margin-bottom: 1.5rem;
      }

      .sub-tabs {
        display: flex;
        flex-wrap: wrap;
        background-color: #f5f5f5;
        border-bottom: 1px solid #ddd;
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
        padding: 0;
        width: 100%;
      }

      .sub-tab {
        padding: 0.8rem 1.2rem;
        cursor: pointer;
        transition: background-color 0.3s;
        font-weight: 500;
        text-align: center;
        flex: 1;
        min-width: 120px;
        font-size: 0.9rem;
      }

      .sub-tab:hover {
        background-color: #e0e0e0;
      }

      .sub-tab.active {
        background-color: #fff;
        border-bottom: 3px solid #007bff;
        color: #007bff;
      }

      .sub-tab-content {
        display: none;
        background-color: #fff;
        padding: 1.5rem 0;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        max-height: calc(100vh - 300px);
        overflow-y: auto;
        width: 100%;
      }

      .sub-tab-content.active {
        display: block;
      }

      .content-box {
        margin-bottom: 2rem;
        width: 100%;
        padding: 0 50px;
      }

      .content-box h3 {
        margin-bottom: 1rem;
        color: #333;
        text-align: center;
      }

      .content-box textarea {
        width: 100%;
        min-height: 200px;
        margin-bottom: 1rem;
        padding: 0.8rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: vertical;
      }

      .save-button {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
      }

      .save-button:hover {
        background-color: #218838;
      }

      /* Token Kullanım bölümü için stiller */
      .token-container {
        max-width: 900px;
        margin: 0 auto;
      }

      .token-stats {
        display: flex;
        justify-content: space-around;
        margin-bottom: 2rem;
      }

      .token-stats-detailed {
        margin-bottom: 2rem;
      }

      .token-stats-detailed h3 {
        color: #333;
        font-size: 1.4rem;
        margin-bottom: 1rem;
        text-align: center;
      }

      .detailed-stats-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        gap: 1rem;
      }

      .stat-box {
        background-color: #fff;
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        flex: 1;
        margin: 0 1rem;
        min-width: 200px;
      }

      .token-stats-detailed .stat-box {
        flex-basis: calc(50% - 2rem);
        margin: 0;
      }

      .stat-box h3 {
        margin-top: 0;
        color: #333;
        font-size: 1.2rem;
      }

      .stat-box h4 {
        margin-top: 0;
        color: #333;
        font-size: 1.1rem;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #007bff;
        margin: 1rem 0;
      }
      
      .token-stats-detailed .stat-box:nth-child(1) .stat-value,
      .token-stats-detailed .stat-box:nth-child(3) .stat-value {
        color: #28a745; /* OpenAI için yeşil renk */
      }
      
      .token-stats-detailed .stat-box:nth-child(2) .stat-value,
      .token-stats-detailed .stat-box:nth-child(4) .stat-value {
        color: #dc3545; /* Anthropic için kırmızı renk */
      }

      .token-table-container {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        overflow-x: auto;
      }

      .token-table {
        width: 100%;
        border-collapse: collapse;
      }

      .token-table th,
      .token-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .token-table th {
        background-color: #f5f5f5;
        font-weight: 600;
        color: #333;
      }

      .token-table tbody tr:hover {
        background-color: #f9f9f9;
      }

      .loading-message {
        text-align: center;
        color: #666;
        padding: 2rem;
      }

      /* Grafik stilleri */
      .chart-container {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-bottom: 2rem;
      }

      .chart-container h3 {
        text-align: center;
        margin-top: 0;
        margin-bottom: 1.5rem;
        color: #333;
      }

      .chart {
        height: 250px;
        display: flex;
        align-items: flex-end;
        justify-content: space-around;
        padding: 0 1rem;
        border-bottom: 2px solid #ddd;
        position: relative;
      }

      .chart::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 2px;
        background-color: #ddd;
      }

      .chart-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #666;
      }

      .chart-bar-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 12%;
      }

      .chart-date {
        font-size: 0.8rem;
        color: #666;
        margin-top: 0.5rem;
        text-align: center;
        transform: rotate(-45deg);
        white-space: nowrap;
        width: 100%;
        height: 40px;
      }

      .chart-bars {
        display: flex;
        width: 100%;
        height: 100%;
        align-items: flex-end;
        justify-content: center;
      }

      .chart-bar {
        width: 40%;
        margin: 0 5%;
        transition: height 0.3s ease;
      }

      .token-bar {
        background-color: #007bff;
      }

      .check-bar {
        background-color: #28a745;
      }

      .chart-legend {
        display: flex;
        justify-content: center;
        margin-top: 3rem;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin: 0 1rem;
      }

      .legend-color {
        width: 20px;
        height: 20px;
        margin-right: 0.5rem;
        border-radius: 4px;
      }

      .token-color {
        background-color: #007bff;
      }

      .check-color {
        background-color: #28a745;
      }

      .chart-y-axis {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        pointer-events: none;
      }

      .y-axis-label {
        font-size: 0.7rem;
        color: #666;
        transform: translateX(-50%);
        text-align: right;
      }

      /* Alkol İçerik tablosu için stiller */
      .alkol-icerik-wrapper {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        padding: 20px 50px;
        overflow-x: auto;
        width: 90%;
        margin: 0 auto;
      }

      .alkol-icerik-wrapper .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        background-color: #fff;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .alkol-icerik-wrapper .actions-container {
        display: flex;
        align-items: center;
      }

      .alkol-icerik-wrapper .add-new-btn {
        display: flex;
        align-items: center;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 12px;
        margin-right: 20px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.3s;
      }

      .alkol-icerik-wrapper .add-new-btn:hover {
        background-color: #218838;
      }

      .alkol-icerik-wrapper .add-new-btn i {
        margin-right: 5px;
      }

      .alkol-icerik-wrapper .header h3 {
        margin: 0;
        font-size: 1.5rem;
        color: #333;
      }

      .alkol-icerik-wrapper .stats {
        display: flex;
        align-items: center;
      }

      .alkol-icerik-wrapper .stat-item {
        margin-left: 20px;
        text-align: center;
      }

      .alkol-icerik-wrapper .stat-value {
        font-size: 1.2rem;
        font-weight: bold;
        color: #007bff;
      }

      .alkol-icerik-wrapper .stat-label {
        font-size: 0.8rem;
        color: #666;
      }

      .alkol-icerik-wrapper .table-container {
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        overflow-x: auto;
      }

      .alkol-icerik-wrapper table {
        width: 100%;
        border-collapse: collapse;
      }

      .alkol-icerik-wrapper th,
      .alkol-icerik-wrapper td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        min-width: 150px;
      }

      .alkol-icerik-wrapper th {
        background-color: #f8f9fa;
        color: #333;
        font-weight: 500;
        position: sticky;
        top: 0;
      }

      .alkol-icerik-wrapper tr:hover {
        background-color: #f5f5f5;
      }

      .alkol-icerik-wrapper .action-cell {
        white-space: nowrap;
        width: 100px;
        min-width: 100px;
      }

      .alkol-icerik-wrapper .edit-btn,
      .alkol-icerik-wrapper .save-btn,
      .alkol-icerik-wrapper .cancel-btn {
        background: none;
        border: none;
        cursor: pointer;
        margin-right: 5px;
        padding: 5px;
        border-radius: 3px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .alkol-icerik-wrapper .edit-btn {
        color: #007bff;
      }

      .alkol-icerik-wrapper .save-btn {
        color: #28a745;
      }

      .alkol-icerik-wrapper .cancel-btn {
        color: #dc3545;
      }

      .alkol-icerik-wrapper .edit-btn:hover,
      .alkol-icerik-wrapper .save-btn:hover,
      .alkol-icerik-wrapper .cancel-btn:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }
      
      /* Active/Inactive Badge Stilleri */
      .status-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        text-align: center;
        min-width: 60px;
      }
      
      .status-badge.active {
        background-color: #28a745;
        color: white;
      }
      
      .status-badge.inactive {
        background-color: #dc3545;
        color: white;
      }
      
      /* Detay Görünümü Stilleri */
      .detail-view {
        background-color: #fff;
        border-radius: 5px;
        padding: 20px;
        margin-top: 20px;
      }
      
      .detail-item {
        margin-bottom: 15px;
      }
      
      .detail-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }
      
      .detail-value {
        color: #555;
        line-height: 1.5;
      }
      
      .content-block {
        white-space: pre-wrap;
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }

      .alkol-icerik-wrapper .edit-mode input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }

      .alkol-icerik-wrapper .edit-mode {
        background-color: #fff8e1;
      }

      .alkol-icerik-wrapper .loading {
        text-align: center;
        padding: 20px;
        font-style: italic;
        color: #666;
      }

      .alkol-icerik-wrapper .error {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
      }

      .alkol-icerik-wrapper .success {
        background-color: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
      }

      .alkol-icerik-wrapper .hidden {
        display: none;
      }

      /* Yeni Kayıt Formu Stilleri */
      .new-word-form-container {
        background-color: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
      }

      .new-word-form {
        width: 100%;
      }

      .form-row {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 15px;
        justify-content: space-between;
      }

      .form-group {
        flex: 0 0 150px;
        margin-bottom: 15px;
        margin-right: 10px;
      }

      .form-group label {
        display: block;
        font-weight: 500;
        margin-bottom: 5px;
        color: #333;
      }

      .form-group textarea {
        width: 150px;
        height: 100px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: none;
      }

      .form-buttons {
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
      }

      .save-new-btn,
      .cancel-new-btn {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        margin-top: 5px;
      }

      .save-new-btn {
        background-color: #28a745;
        color: white;
      }

      .save-new-btn:hover {
        background-color: #218838;
      }

      .cancel-new-btn {
        background-color: #dc3545;
        color: white;
      }

      .cancel-new-btn:hover {
        background-color: #c82333;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Ai Projects</h1>
      <div class="logout-button" onclick="logout()">
        <i class="material-icons">exit_to_app</i> Çıkış
      </div>
    </div>

    <div class="tab-container">
      <div class="tabs">
        <div class="tab" data-tab="tab1">Helal Kontrol</div>
        <div class="tab" data-tab="tab2">Lernen Ai</div>
        <div class="tab" data-tab="tab3">Token Kullanım</div>
        <div class="tab" data-tab="tab4">Hata Bildirimleri</div>
      </div>

      <!-- Tab 1: Yapay Zeka Kelimeleri (Mevcut içerik) -->
      <div id="tab1" class="tab-content">
        <div class="container">
          <h2>Helal Kontrol Bilgilerini Güncelle</h2>
          <form id="helalForm">
            <label for="baseTalimat">Base Talimat:</label>
            <textarea id="baseTalimat" required></textarea>

            <label for="detayliTalimat">Detaylı Talimat:</label>
            <textarea id="detayliTalimat" required></textarea>

            <label for="eCode">E Kodu:</label>
            <textarea id="eCode"></textarea>

            <label for="alcoholWords">Alkol Kelimeleri:</label>
            <textarea id="alcoholWords"></textarea>

            <label for="containingAlcohol">İçeren Alkol:</label>
            <textarea id="containingAlcohol"></textarea>

            <label for="animalProduct">Hayvansal Ürün:</label>
            <textarea id="animalProduct"></textarea>

            <label for="notConsideredAlcohol">Alkol Sayılmayanlar:</label>
            <textarea id="notConsideredAlcohol"></textarea>

            <h3>Barcode Talimatlari</h3>
            <label for="barcodeBaseTalimat">Barcode Base Talimat:</label>
            <textarea id="barcodeBaseTalimat"></textarea>

            <label for="barcodeDetayliTalimat">Barcode Detaylı Talimat:</label>
            <textarea id="barcodeDetayliTalimat"></textarea>

            <button type="submit">Güncelle</button>
          </form>

          <div id="response"></div>
          <div
            id="formalizeResponse"
            style="margin-top: 1rem; color: #28a745"
          ></div>
        </div>
      </div>

      <!-- Tab 2: Barcode Kelimeler -->
      <div id="tab2" class="tab-content">
        <div class="barcode-container">
          <h2>Barcode Kelimeler</h2>

          <!-- Barcode Kelimeler için alt tablar -->
          <div class="sub-tabs">
            <!-- <div class="sub-tab active" data-subtab="subtab1">Alkol İçerik</div> -->
            <div class="sub-tab" data-subtab="subtab2">Assistant Ai</div>
            <div class="sub-tab" data-subtab="subtab3">Classes</div>
            <div class="sub-tab" data-subtab="subtab4">Base Instruction</div>
            <div class="sub-tab" data-subtab="subtab5">Lernen-Ai Users</div>
            <!-- <div class="sub-tab" data-subtab="subtab6">Helal-Hayvansal</div> -->
          </div>

          <!-- Alt tab içerikleri -->
          <div class="sub-tab-contents">
            <!-- Alkol İçerik -->
            <div id="subtab1" class="sub-tab-content active">
              <div
                class="content-box"
                id="alkolIcerikContainer"
                style="width: 100%; max-width: 100%"
              >
                <h3>Alkol İçeren Maddeler</h3>
                <div class="alkol-icerik-wrapper">
                  <div class="header">
                    <h3>Alkol İçerik Yönetimi</h3>
                    <div class="actions-container">
                      <button id="addNewWordBtn" class="add-new-btn">
                        <i class="material-icons">add</i> Yeni Kayıt
                      </button>
                      <div class="stats">
                        <div class="stat-item">
                          <div class="stat-value" id="totalItems">0</div>
                          <div class="stat-label">Toplam Kayıt</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div id="notification" class="hidden"></div>

                  <div
                    id="newWordFormContainer"
                    class="new-word-form-container hidden"
                  >
                    <div class="new-word-form">
                      <div class="form-row">
                        <div class="form-group">
                          <label for="newEn">EN</label>
                          <textarea id="newEn" name="en" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newTr">TR</label>
                          <textarea id="newTr" name="tr" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newDe">DE</label>
                          <textarea id="newDe" name="de" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newFr">FR</label>
                          <textarea id="newFr" name="fr" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newIt">IT</label>
                          <textarea id="newIt" name="it" rows="4"></textarea>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group">
                          <label for="newEs">ES</label>
                          <textarea id="newEs" name="es" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newPt">PT</label>
                          <textarea id="newPt" name="pt" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newNl">NL</label>
                          <textarea id="newNl" name="nl" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newPl">PL</label>
                          <textarea id="newPl" name="pl" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newSe">SE</label>
                          <textarea id="newSe" name="se" rows="4"></textarea>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group">
                          <label for="newNo">NO</label>
                          <textarea id="newNo" name="no" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newDk">DK</label>
                          <textarea id="newDk" name="dk" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newFi">FI</label>
                          <textarea id="newFi" name="fi" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newRu">RU</label>
                          <textarea id="newRu" name="ru" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newUa">UA</label>
                          <textarea id="newUa" name="ua" rows="4"></textarea>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group">
                          <label for="newRo">RO</label>
                          <textarea id="newRo" name="ro" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newGr">GR</label>
                          <textarea id="newGr" name="gr" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newHu">HU</label>
                          <textarea id="newHu" name="hu" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="newCz">CZ</label>
                          <textarea id="newCz" name="cz" rows="4"></textarea>
                        </div>
                        <div class="form-group form-buttons">
                          <button id="saveNewWordBtn" class="save-new-btn">
                            Kaydet
                          </button>
                          <button id="cancelNewWordBtn" class="cancel-new-btn">
                            İptal
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="table-container">
                    <table id="alkolTable">
                      <thead>
                        <tr>
                          <th class="action-cell">İşlemler</th>
                          <th>EN</th>
                          <th>TR</th>
                          <th>DE</th>
                          <th>FR</th>
                          <th>IT</th>
                          <th>ES</th>
                          <th>PT</th>
                          <th>NL</th>
                          <th>PL</th>
                          <th>SE</th>
                          <th>NO</th>
                          <th>DK</th>
                          <th>FI</th>
                          <th>RU</th>
                          <th>UA</th>
                          <th>RO</th>
                          <th>GR</th>
                          <th>HU</th>
                          <th>CZ</th>
                        </tr>
                      </thead>
                      <tbody id="tableBody">
                        <tr>
                          <td colspan="20" class="loading">
                            Veriler yükleniyor...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Hayvansal İçerik / Asistanlar -->
            <div id="subtab2" class="sub-tab-content">
              <div class="content-box" id="assistantAiContainer" style="width: 100%; max-width: 100%">
                <h3>AI Asistanları</h3>
                <div class="alkol-icerik-wrapper">
                  <div class="header">
                    <h3>AI Asistan Yönetimi</h3>
                    <div class="actions-container">
                      <button id="addNewAssistantBtn" class="add-new-btn">
                        <i class="material-icons">add</i> Create New Assistant
                      </button>
                      <div class="stats">
                        <div class="stat-item">
                          <div class="stat-value" id="totalAssistants">0</div>
                          <div class="stat-label">Toplam Asistan</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div id="assistantNotification" class="hidden"></div>

                  <div id="newAssistantFormContainer" class="new-word-form-container hidden">
                    <div class="new-word-form">
                      <div class="form-row">
                        <div class="form-group" style="flex: 0 0 300px;">
                          <label for="newAssistantName">Asistan Adı</label>
                          <textarea id="newAssistantName" name="name" rows="1"></textarea>
                        </div>
                        <div class="form-group" style="flex: 0 0 300px;">
                          <label for="newAssistantLanguage">Dil</label>
                          <textarea id="newAssistantLanguage" name="language" rows="1"></textarea>
                        </div>
                        <div class="form-group" style="flex: 0 0 300px;">
                          <label for="newAssistantId">Asistan ID (Opsiyonel)</label>
                          <textarea id="newAssistantId" name="assistantId" rows="1"></textarea>
                        </div>
                        <div class="form-group" style="flex: 0 0 100px; display: flex; align-items: center;">
                          <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="newAssistantActive" name="active" checked style="margin-right: 8px; width: 18px; height: 18px;">
                            <span>Aktif</span>
                          </label>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                          <label for="newAssistantInstruction">Talimatlar</label>
                          <textarea id="newAssistantInstruction" name="instruction" rows="6" style="width: 100%;"></textarea>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group form-buttons" style="margin-left: auto;">
                          <button id="saveNewAssistantBtn" class="save-new-btn">
                            Kaydet
                          </button>
                          <button id="cancelNewAssistantBtn" class="cancel-new-btn">
                            İptal
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="table-container">
                    <table id="assistantTable">
                      <thead>
                        <tr>
                          <th class="action-cell">İşlemler</th>
                          <th>Asistan Adı</th>
                          <th>Dil</th>
                          <th>Talimatlar</th>
                          <th>Asistan ID</th>
                          <th>Aktif</th>
                          <th>Oluşturulma Tarihi</th>
                          <th>Güncellenme Tarihi</th>
                        </tr>
                      </thead>
                      <tbody id="assistantTableBody">
                        <tr>
                          <td colspan="7" class="loading">
                            Veriler yükleniyor...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Classes -->
            <div id="subtab3" class="sub-tab-content">
              <div class="content-box" id="classesContainer" style="width: 100%; max-width: 100%">
                <h3>Sınıflar</h3>
                <div class="alkol-icerik-wrapper">
                  <div class="header">
                    <h3>Sınıf Yönetimi</h3>
                    <div class="actions-container">
                      <button id="addNewClassBtn" class="add-new-btn">
                        <i class="material-icons">add</i> Create New Class
                      </button>
                      <div class="stats">
                        <div class="stat-item">
                          <div class="stat-value" id="totalClasses">0</div>
                          <div class="stat-label">Toplam Sınıf</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div id="classNotification" class="hidden"></div>

                  <div id="newClassFormContainer" class="new-word-form-container hidden">
                    <div class="new-word-form">
                      <div class="form-row">
                        <div class="form-group" style="flex: 0 0 300px;">
                          <label for="newClassName">Sınıf Adı</label>
                          <textarea id="newClassName" name="name" rows="1"></textarea>
                        </div>
                        <div class="form-group" style="flex: 1;">
                          <label for="newClassDescription">Açıklama</label>
                          <textarea id="newClassDescription" name="description" rows="1"></textarea>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                          <label for="newClassIcon">Sınıf İkonu</label>
                          <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="file" id="newClassIcon" accept="image/*" style="flex: 1;">
                            <div id="iconPreviewContainer" style="width: 100px; height: 100px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                              <img id="iconPreview" style="max-width: 100%; max-height: 100%; display: none;">
                              <span id="noIconText">Resim yok</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                          <label for="newClassInstruction">Talimatlar</label>
                          <textarea id="newClassInstruction" name="instruction" rows="6" style="width: 100%;"></textarea>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                          <label for="newClassAssistantId">Asistan Seç</label>
                          <select id="newClassAssistantId" name="assistantId" style="width: 100%; padding: 8px; height: 40px;">
                            <option value="">Asistan Seçiniz...</option>
                          </select>
                        </div>
                        <div class="form-group form-buttons" style="margin-left: auto;">
                          <button id="saveNewClassBtn" class="save-new-btn">
                            Kaydet
                          </button>
                          <button id="cancelNewClassBtn" class="cancel-new-btn">
                            İptal
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="table-container">
                    <table id="classTable">
                      <thead>
                        <tr>
                          <th class="action-cell">İşlemler</th>
                          <th>İkon</th>
                          <th>Sınıf Adı</th>
                          <th>Açıklama</th>
                          <th>Talimatlar</th>
                          <th>Asistan</th>
                          <th>Oluşturulma Tarihi</th>
                          <th>Güncellenme Tarihi</th>
                        </tr>
                      </thead>
                      <tbody id="classTableBody">
                        <tr>
                          <td colspan="7" class="loading">
                            Veriler yükleniyor...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Non-Alkol / Base Instruction -->
            <div id="subtab4" class="sub-tab-content">
              <div class="content-box" id="baseInstructionContainer" style="width: 100%; max-width: 100%">
                <h3>Temel Talimat Yönetimi</h3>
                <div class="button-group" style="margin: 10px 0; display: flex; gap: 10px;">
                  <button id="baseCodeGrammerBtn" class="action-btn" style="background-color: #007bff; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;" data-code="BaseCodeGrammer">Gramer Talimatı</button>
                  <button id="baseCodeVoiceBtn" class="action-btn" style="background-color: #6c757d; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;" data-code="BaseCodeVoice">Ses Talimatı</button>
                </div>
                <div class="alkol-icerik-wrapper">
                  <div class="header">
                    <h3>Temel Talimat</h3>
                    <div class="actions-container">
                      <button id="editBaseInstructionBtn" class="edit-btn">
                        <i class="material-icons">edit</i> Düzenle
                      </button>
                      <div class="stats">
                        <div class="stat-item">
                          <div class="stat-label">Son Güncelleme</div>
                          <div class="stat-value" id="baseInstructionLastUpdate">-</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div id="baseInstructionNotification" class="hidden"></div>

                  <div id="baseInstructionFormContainer" class="new-word-form-container hidden">
                    <div class="new-word-form">
                      <div class="form-row">
                        <div class="form-group" style="flex: 0 0 300px;">
                          <label for="baseInstructionCode">Kod</label>
                          <textarea id="baseInstructionCode" name="code" rows="1"></textarea>
                        </div>
                        <div class="form-group" style="flex: 1;">
                          <label for="baseInstructionDescription">Açıklama</label>
                          <textarea id="baseInstructionDescription" name="description" rows="1"></textarea>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                          <label for="baseInstructionContent">Temel Talimat</label>
                          <textarea id="baseInstructionContent" name="baseInstruction" rows="10" style="width: 100%;"></textarea>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group form-buttons" style="margin-left: auto;">
                          <button id="saveBaseInstructionBtn" class="save-new-btn">
                            Güncelle
                          </button>
                          <button id="cancelBaseInstructionBtn" class="cancel-new-btn">
                            İptal
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="detail-view" id="baseInstructionDetailView">
                    <div class="detail-item">
                      <div class="detail-label">Kod:</div>
                      <div class="detail-value" id="baseInstructionCodeValue">-</div>
                    </div>
                    <div class="detail-item">
                      <div class="detail-label">Açıklama:</div>
                      <div class="detail-value" id="baseInstructionDescriptionValue">-</div>
                    </div>
                    <div class="detail-item">
                      <div class="detail-label">Temel Talimat:</div>
                      <div class="detail-value content-block" id="baseInstructionContentValue">-</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Kullanıcı Yönetimi -->
            <div id="subtab5" class="sub-tab-content">
              <div class="content-box" id="usersContainer" style="width: 100%; max-width: 100%">
                <h3>Kullanıcı Yönetimi</h3>
                <div class="alkol-icerik-wrapper">
                  <div class="header">
                    <h3>Kullanıcı Listesi</h3>
                    <div class="actions-container">
                      <div class="stats">
                        <div class="stat-item">
                          <div class="stat-value" id="totalUsers">0</div>
                          <div class="stat-label">Toplam Kullanıcı</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div id="usersNotification" class="hidden"></div>

                  <div class="table-container">
                    <table id="usersTable">
                      <thead>
                        <tr>
                          <th>Kullanıcı Adı</th>
                          <th>E-posta</th>
                          <th>Kullanıcı Kodu</th>
                          <th>Oluşturulma Tarihi</th>
                          <th>Güncellenme Tarihi</th>
                        </tr>
                      </thead>
                      <tbody id="usersTableBody">
                        <tr>
                          <td colspan="5" class="loading">
                            Veriler yükleniyor...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Helal-Hayvansal -->
            <div id="subtab6" class="sub-tab-content">
              <div class="content-box">
                <h3>Helal Hayvansal Ürünler</h3>
                <p>
                  Bu bölümde helal hayvansal ürünlerin listesi yer alacaktır.
                </p>
                <textarea
                  id="halalAnimalContent"
                  placeholder="Helal hayvansal ürünleri buraya ekleyin..."
                ></textarea>
                <button class="save-button">Kaydet</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab 3: Token Kullanım -->
      <div id="tab3" class="tab-content">
        <div class="token-container">
          <h2>Token Kullanım</h2>

          <!-- Toplam İstatistikler -->
          <div class="token-stats">
            <div class="stat-box">
              <h3>Toplam Token Sayısı</h3>
              <div class="stat-value" id="totalTokenSum">Yükleniyor...</div>
            </div>
            <div class="stat-box">
              <h3>Toplam Kontrol Sayısı</h3>
              <div class="stat-value" id="totalCheckCallSum">Yükleniyor...</div>
            </div>
          </div>

          <!-- Detaylı Token İstatistikleri -->
          <div class="token-stats-detailed">
            <h3>Detaylı Token Kullanımı</h3>
            <div class="detailed-stats-container">
              <!-- Helal Kontrol Token Kullanımı -->
              <div class="stat-box">
                <h4>Helal Kontrol - OpenAI</h4>
                <div class="stat-value" id="totalTokenCountOpenAiHelalControl">Yükleniyor...</div>
              </div>
              <div class="stat-box">
                <h4>Helal Kontrol - Anthropic</h4>
                <div class="stat-value" id="totalTokenCountAnthropicHelalControl">Yükleniyor...</div>
              </div>
              
              <!-- Lernen AI Token Kullanımı -->
              <div class="stat-box">
                <h4>Lernen AI - OpenAI</h4>
                <div class="stat-value" id="totalTokenCountOpenAiLernenAi">Yükleniyor...</div>
              </div>
              <div class="stat-box">
                <h4>Lernen AI - Anthropic</h4>
                <div class="stat-value" id="totalTokenCountAnthropicLernenAi">Yükleniyor...</div>
              </div>
            </div>
          </div>

          <!-- Kontrol Sayıları Detay -->
          <div class="token-stats-detailed">
            <h3>Detaylı Kontrol Sayıları</h3>
            <div class="detailed-stats-container">
              <div class="stat-box">
                <h4>Helal Kontrol Çağrıları</h4>
                <div class="stat-value" id="checkCallCount">Yükleniyor...</div>
              </div>
              <div class="stat-box">
                <h4>Lernen AI Çağrıları</h4>
                <div class="stat-value" id="checkCallCountLernenAi">Yükleniyor...</div>
              </div>
            </div>
          </div>

          <!-- Son 1 Haftalık Grafik -->
          <div class="chart-container">
            <h3>Son 1 Haftalık Token Kullanımı</h3>
            <div class="chart" id="tokenChart">
              <div class="chart-loading">Grafik yükleniyor...</div>
            </div>
            <div class="chart-legend">
              <div class="legend-item">
                <div class="legend-color token-color"></div>
                <div>Token Sayısı</div>
              </div>
              <div class="legend-item">
                <div class="legend-color check-color"></div>
                <div>Kontrol Sayısı</div>
              </div>
            </div>
          </div>

          <!-- Token Kullanım Tablosu -->
          <div class="token-table-container">
            <table class="token-table">
              <thead>
                <tr>
                  <th>Tarih</th>
                  <th>Toplam Token</th>
                  <th>Helal Kontrol OpenAI</th>
                  <th>Helal Kontrol Anthropic</th>
                  <th>Lernen AI OpenAI</th>
                  <th>Lernen AI Anthropic</th>
                  <th>Helal Kontrol Çağrı</th>
                  <th>Lernen AI Çağrı</th>
                </tr>
              </thead>
              <tbody id="tokenTableBody">
                <tr>
                  <td colspan="8" class="loading-message">
                    Veriler yükleniyor...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Tab 4: Hata Bildirimleri -->
      <div id="tab4" class="tab-content">
        <div class="empty-tab">
          <h2>Hata Bildirimleri</h2>
          <p>Bu bölüm henüz hazırlanmaktadır.</p>
        </div>
      </div>
    </div>

    <script>
      // Tab işlevselliği
      document.addEventListener("DOMContentLoaded", function () {
        const tabs = document.querySelectorAll(".tab");
        const tabContents = document.querySelectorAll(".tab-content");
        const subTabs = document.querySelectorAll(".sub-tab");
        const subTabContents = document.querySelectorAll(".sub-tab-content");

        // İlk açılışta 4. tab'ı aktif yap
        activateTab("tab4");

        tabs.forEach((tab) => {
          tab.addEventListener("click", function () {
            const tabId = this.getAttribute("data-tab");
            activateTab(tabId);
          });
        });

        // Alt tablar için tıklama olayı
        subTabs.forEach((subTab) => {
          subTab.addEventListener("click", function () {
            const subTabId = this.getAttribute("data-subtab");
            activateSubTab(subTabId);
          });
        });

        function activateTab(tabId) {
          // Tüm tabları ve içeriklerini deaktif yap
          tabs.forEach((tab) => tab.classList.remove("active"));
          tabContents.forEach((content) => content.classList.remove("active"));

          // Seçilen tabı ve içeriğini aktif yap
          document
            .querySelector(`.tab[data-tab="${tabId}"]`)
            .classList.add("active");
          document.getElementById(tabId).classList.add("active");

          // Eğer Barcode Kelimeler tabı seçildiyse, ilk alt tabı aktif yap
          if (tabId === "tab2") {
            activateSubTab("subtab1");
          }
        }

        function activateSubTab(subTabId) {
          // Tüm alt tabları ve içeriklerini deaktif yap
          subTabs.forEach((subTab) => subTab.classList.remove("active"));
          subTabContents.forEach((content) =>
            content.classList.remove("active")
          );

          // Seçilen alt tabı ve içeriğini aktif yap
          document
            .querySelector(`.sub-tab[data-subtab="${subTabId}"]`)
            .classList.add("active");
          document.getElementById(subTabId).classList.add("active");
        }

        // Formalize Et butonuna tıklanınca çalışacak fonksiyon
        // Bu kısmı yorum satırına aldım çünkü HTML'de de yorum satırına alınmış
        /*
        document
          .getElementById("formalizeButton")
          .addEventListener("click", async function () {
            let res = window.confirm("Formalize etmek istediginden eminmisin!!!");
            if (!res) {
              console.log("KAbul edilmedi");
              return;
            }
            try {
              const res = await fetch(
                `${BASE_URL}/helal-kontrol/normalize-fields`,
                {
                  method: "PUT",
                }
              );

              const result = await res.text(); // String dönecek
              document.getElementById("formalizeResponse").innerText =
                "Sonuç: " + result;
            } catch (err) {
              document.getElementById("formalizeResponse").innerText =
                "Hata: " + err.message;
            }
          });
        */

        // Verileri çek ve textarea'lara yerleştir
        async function fetchAndFillData() {
          try {
            const res = await fetch(`${BASE_URL}/xhelal-kontrol/base-talimat`);
            if (!res.ok) throw new Error("Kayıt bulunamadı");
            const data = await res.json();

            // Her alanı doldur
            document.getElementById("baseTalimat").value =
              data.baseTalimat || "";
            document.getElementById("detayliTalimat").value =
              data.detayliTalimat || "";
            document.getElementById("eCode").value = data.eCode || "";
            document.getElementById("alcoholWords").value =
              data.alcoholWords || "";
            document.getElementById("containingAlcohol").value =
              data.containingAlcohol || "";
            document.getElementById("animalProduct").value =
              data.animalProduct || "";
            document.getElementById("notConsideredAlcohol").value =
              data.notConsideredAlcohol || "";
            document.getElementById("barcodeBaseTalimat").value =
              data.barcodeBaseTalimat || "";
            document.getElementById("barcodeDetayliTalimat").value =
              data.barcodeDetayliTalimat || "";

            document.getElementById("response").innerText = "Veriler yüklendi.";
          } catch (err) {
            document.getElementById("response").innerText =
              "Hata: " + err.message;
          }
        }

        // Güncelleme işlemi
        document
          .getElementById("helalForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const data = {
              baseTalimat: document.getElementById("baseTalimat").value,
              detayliTalimat: document.getElementById("detayliTalimat").value,
              eCode: document.getElementById("eCode").value || null,
              alcoholWords:
                document.getElementById("alcoholWords").value || null,
              containingAlcohol:
                document.getElementById("containingAlcohol").value || null,
              animalProduct:
                document.getElementById("animalProduct").value || null,
              notConsideredAlcohol:
                document.getElementById("notConsideredAlcohol").value || null,
              barcodeBaseTalimat:
                document.getElementById("barcodeBaseTalimat").value || null,
              barcodeDetayliTalimat:
                document.getElementById("barcodeDetayliTalimat").value || null,
            };

            try {
              const res = await fetch(`${BASE_URL}/xhelal-kontrol`, {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              });

              const result = await res.json();
              document.getElementById("response").innerText =
                "Güncellendi:\n" + JSON.stringify(result, null, 2);
            } catch (err) {
              document.getElementById("response").innerText =
                "Güncelleme hatası: " + err.message;
            }
          });

        // Yapay Zeka Kelimeleri tabı aktif olduğunda verileri çek
        document
          .querySelector('.tab[data-tab="tab1"]')
          .addEventListener("click", fetchAndFillData);

        // Token Kullanım tabı aktif olduğunda verileri çek
        document
          .querySelector('.tab[data-tab="tab3"]')
          .addEventListener("click", fetchTokenUsageData);

        // Token kullanım verilerini çek ve tabloya yerleştir
        async function fetchTokenUsageData() {
          try {
            const tokenTableBody = document.getElementById("tokenTableBody");
            const totalTokenSum = document.getElementById("totalTokenSum");
            const totalCheckCallSum =
              document.getElementById("totalCheckCallSum");
            const tokenChart = document.getElementById("tokenChart");

            // Yükleniyor mesajını göster
            tokenTableBody.innerHTML =
              '<tr><td colspan="3" class="loading-message">Veriler yükleniyor...</td></tr>';
            totalTokenSum.innerText = "Yükleniyor...";
            totalCheckCallSum.innerText = "Yükleniyor...";
            tokenChart.innerHTML =
              '<div class="chart-loading">Grafik yükleniyor...</div>';

            // API'den verileri çek
            const response = await fetch(`${BASE_URL}/used-stor`);

            if (!response.ok) {
              throw new Error("Veriler alınırken bir hata oluştu");
            }

            const data = await response.json();

            // Verileri tarihe göre sırala (en yeniden en eskiye)
            data.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            // Toplam değerleri hesapla
            let tokenSumTotal = 0;
            let checkCallSumTotal = 0;

            data.forEach((item) => {
              tokenSumTotal += item.totalTokenCount;
              checkCallSumTotal += item.checkCallCount;
            });

            // Toplam değerleri göster
            totalTokenSum.innerText = tokenSumTotal.toLocaleString();
            totalCheckCallSum.innerText = checkCallSumTotal.toLocaleString();

            // Son 7 gün için tarih aralığı oluştur (bugün dahil)
            const today = new Date();
            today.setHours(23, 59, 59, 999); // Bugünün sonuna ayarla

            const oneWeekAgo = new Date(today);
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 6); // 7 gün için 6 gün öncesi
            oneWeekAgo.setHours(0, 0, 0, 0); // Günün başına ayarla

            // Son 7 gün için boş günlük veri yapısı oluştur
            const dailyData = {};

            // Son 7 günün her biri için boş kayıtlar oluştur
            for (let i = 0; i < 7; i++) {
              const date = new Date(oneWeekAgo);
              date.setDate(date.getDate() + i);
              const dateStr = date.toISOString().split("T")[0]; // YYYY-MM-DD formatında

              dailyData[dateStr] = {
                date: new Date(date),
                totalTokenCount: 0,
                checkCallCount: 0,
              };
            }

            // Tarih karşılaştırma için yardımcı fonksiyon
            function isSameDay(date1, date2) {
              return (
                date1.getFullYear() === date2.getFullYear() &&
                date1.getMonth() === date2.getMonth() &&
                date1.getDate() === date2.getDate()
              );
            }

            // Son 7 gün içindeki verileri filtrele
            const lastWeekData = data.filter((item) => {
              const itemDate = new Date(item.createdAt);

              // Son 7 gün içindeki herhangi bir güne ait mi kontrol et
              for (let i = 0; i < 7; i++) {
                const checkDate = new Date(oneWeekAgo);
                checkDate.setDate(checkDate.getDate() + i);

                if (isSameDay(itemDate, checkDate)) {
                  return true;
                }
              }

              return false;
            });

            // Verileri günlere göre grupla
            lastWeekData.forEach((item) => {
              // Tarih karşılaştırma için her bir günü kontrol et
              for (const dateStr in dailyData) {
                const currentDate = dailyData[dateStr].date;
                const itemDate = new Date(item.createdAt);

                if (isSameDay(currentDate, itemDate)) {
                  dailyData[dateStr].totalTokenCount += item.totalTokenCount;
                  dailyData[dateStr].checkCallCount += item.checkCallCount;
                  break;
                }
              }
            });

            // Günlük verileri diziye dönüştür ve tarihe göre sırala
            const dailyDataArray = Object.values(dailyData);
            dailyDataArray.sort((a, b) => a.date - b.date);

            // Grafik için maksimum değeri bul (10000'in katları olacak şekilde)
            let maxTokenCount = Math.max(
              ...dailyDataArray.map((item) => item.totalTokenCount),
              10000
            );
            maxTokenCount = Math.ceil(maxTokenCount / 10000) * 10000;

            // Grafik için Y ekseni etiketlerini oluştur
            const yAxisLabels = [];
            for (let i = 0; i <= 5; i++) {
              yAxisLabels.push(
                Math.round((maxTokenCount * i) / 5).toLocaleString()
              );
            }

            // Grafik içeriğini oluştur
            let chartHTML = `
              <div class="chart-y-axis">
                ${yAxisLabels
                  .reverse()
                  .map((label) => `<div class="y-axis-label">${label}</div>`)
                  .join("")}
              </div>
            `;

            // Eğer veri yoksa mesaj göster
            if (dailyDataArray.length === 0) {
              tokenChart.innerHTML =
                '<div class="chart-loading">Son 1 hafta için veri bulunamadı</div>';
            } else {
              // Her gün için sütunları oluştur
              dailyDataArray.forEach((dayData) => {
                const tokenBarHeight =
                  (dayData.totalTokenCount / maxTokenCount) * 100;
                const checkBarHeight =
                  (dayData.checkCallCount / maxTokenCount) * 100;

                const formattedDate =
                  dayData.date.toLocaleDateString("tr-TR", {
                    day: "numeric",
                    month: "short",
                  }) + (isSameDay(dayData.date, new Date()) ? " (Bugün)" : "");

                chartHTML += `
                  <div class="chart-bar-group">
                    <div class="chart-bars">
                      <div class="chart-bar token-bar" style="height: ${tokenBarHeight}%" title="${dayData.totalTokenCount.toLocaleString()} token"></div>
                      <div class="chart-bar check-bar" style="height: ${checkBarHeight}%" title="${dayData.checkCallCount.toLocaleString()} kontrol"></div>
                    </div>
                    <div class="chart-date">${formattedDate}</div>
                  </div>
                `;
              });

              tokenChart.innerHTML = chartHTML;
            }

            // Tablo içeriğini oluştur
            if (data.length === 0) {
              tokenTableBody.innerHTML =
                '<tr><td colspan="3" class="loading-message">Veri bulunamadı</td></tr>';
            } else {
              tokenTableBody.innerHTML = "";

              data.forEach((item) => {
                const row = document.createElement("tr");

                // Tarihi formatla
                const date = new Date(item.createdAt);
                const formattedDate = date.toLocaleDateString("tr-TR", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                  hour: "2-digit",
                  minute: "2-digit",
                });

                row.innerHTML = `
                  <td>${formattedDate}</td>
                  <td>${item.totalTokenCount.toLocaleString()}</td>
                  <td>${item.checkCallCount.toLocaleString()}</td>
                `;

                tokenTableBody.appendChild(row);
              });
            }
          } catch (error) {
            console.error("Token kullanım verileri alınırken hata:", error);
            document.getElementById(
              "tokenTableBody"
            ).innerHTML = `<tr><td colspan="3" class="loading-message">Hata: ${error.message}</td></tr>`;
            document.getElementById("totalTokenSum").innerText = "Hata";
            document.getElementById("totalCheckCallSum").innerText = "Hata";
            document.getElementById(
              "tokenChart"
            ).innerHTML = `<div class="chart-loading">Hata: ${error.message}</div>`;
          }
        }

        // Alkol İçerik tablosu için fonksiyonlar
        async function fetchAlkolData() {
          try {
            const response = await fetch(`${BASE_URL}/alkol-maddeleri`);

            if (!response.ok) {
              throw new Error("Veriler alınırken bir hata oluştu");
            }

            const data = await response.json();

            // Toplam kayıt sayısını güncelle
            document.getElementById("totalItems").textContent = data.length;

            // Tabloyu doldur
            renderAlkolTable(data);
          } catch (error) {
            console.error("Veri çekme hatası:", error);
            showAlkolNotification("error", `Hata: ${error.message}`);
            document.getElementById("tableBody").innerHTML = `
              <tr>
                <td colspan="20" class="error">Veriler yüklenemedi: ${error.message}</td>
              </tr>
            `;
          }
        }

        // Tabloyu oluştur
        function renderAlkolTable(data) {
          const tableBody = document.getElementById("tableBody");

          if (data.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="20" class="loading">Kayıt bulunamadı</td>
              </tr>
            `;
            return;
          }

          tableBody.innerHTML = "";

          data.forEach((item) => {
            const row = document.createElement("tr");
            row.dataset.id = item.id;

            row.innerHTML = `
              <td class="action-cell">
                <button class="edit-btn" onclick="editRow('${item.id}')">
                  <i class="material-icons">edit</i>
                </button>
                <button class="save-btn hidden" onclick="saveRow('${item.id}')">
                  <i class="material-icons">save</i>
                </button>
                <button class="cancel-btn hidden" onclick="cancelEdit('${
                  item.id
                }')">
                  <i class="material-icons">close</i>
                </button>
              </td>
              <td data-field="en">${item.en || ""}</td>
              <td data-field="tr">${item.tr || ""}</td>
              <td data-field="de">${item.de || ""}</td>
              <td data-field="fr">${item.fr || ""}</td>
              <td data-field="it">${item.it || ""}</td>
              <td data-field="es">${item.es || ""}</td>
              <td data-field="pt">${item.pt || ""}</td>
              <td data-field="nl">${item.nl || ""}</td>
              <td data-field="pl">${item.pl || ""}</td>
              <td data-field="se">${item.se || ""}</td>
              <td data-field="no">${item.no || ""}</td>
              <td data-field="dk">${item.dk || ""}</td>
              <td data-field="fi">${item.fi || ""}</td>
              <td data-field="ru">${item.ru || ""}</td>
              <td data-field="ua">${item.ua || ""}</td>
              <td data-field="ro">${item.ro || ""}</td>
              <td data-field="gr">${item.gr || ""}</td>
              <td data-field="hu">${item.hu || ""}</td>
              <td data-field="cz">${item.cz || ""}</td>
            `;

            tableBody.appendChild(row);
          });
        }

        // Satırı düzenleme moduna geçir
        function editRow(id) {
          const row = document.querySelector(`tr[data-id="${id}"]`);

          // Düzenleme modunu etkinleştir
          row.classList.add("edit-mode");

          // Butonları değiştir
          row.querySelector(".edit-btn").classList.add("hidden");
          row.querySelector(".save-btn").classList.remove("hidden");
          row.querySelector(".cancel-btn").classList.remove("hidden");

          // Hücreleri input'a dönüştür
          const cells = row.querySelectorAll("td[data-field]");
          cells.forEach((cell) => {
            const field = cell.getAttribute("data-field");
            const value = cell.textContent;

            // Orijinal değeri sakla
            cell.dataset.originalValue = value;

            // Input oluştur
            cell.innerHTML = `<input type="text" name="${field}" value="${value}">`;
          });
        }

        // Değişiklikleri kaydet
        async function saveRow(id) {
          const row = document.querySelector(`tr[data-id="${id}"]`);

          // Değerleri topla
          const data = {
            id: id,
          };

          const inputs = row.querySelectorAll("input");
          inputs.forEach((input) => {
            data[input.name] = input.value;
          });

          try {
            // API'ye gönder
            const response = await fetch(`${BASE_URL}/alkol-maddeleri`, {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });

            if (!response.ok) {
              throw new Error("Güncelleme sırasında bir hata oluştu");
            }

            const result = await response.json();

            // Düzenleme modundan çık
            exitEditMode(row, result);

            // Başarı mesajı göster
            showAlkolNotification("success", "Kayıt başarıyla güncellendi");
          } catch (error) {
            console.error("Güncelleme hatası:", error);
            showAlkolNotification("error", `Hata: ${error.message}`);
          }
        }

        // Düzenlemeyi iptal et
        function cancelEdit(id) {
          const row = document.querySelector(`tr[data-id="${id}"]`);

          // Hücreleri orijinal değerlerine geri döndür
          const cells = row.querySelectorAll("td[data-field]");
          cells.forEach((cell) => {
            const originalValue = cell.dataset.originalValue || "";
            cell.textContent = originalValue;
          });

          // Düzenleme modundan çık
          row.classList.remove("edit-mode");

          // Butonları geri al
          row.querySelector(".edit-btn").classList.remove("hidden");
          row.querySelector(".save-btn").classList.add("hidden");
          row.querySelector(".cancel-btn").classList.add("hidden");
        }

        // Düzenleme modundan çık ve yeni değerleri göster
        function exitEditMode(row, data) {
          // Düzenleme modunu kapat
          row.classList.remove("edit-mode");

          // Butonları geri al
          row.querySelector(".edit-btn").classList.remove("hidden");
          row.querySelector(".save-btn").classList.add("hidden");
          row.querySelector(".cancel-btn").classList.add("hidden");

          // Hücreleri güncelle
          const cells = row.querySelectorAll("td[data-field]");
          cells.forEach((cell) => {
            const field = cell.getAttribute("data-field");
            cell.textContent = data[field] || "";
          });
        }

        // Bildirim göster
        function showAlkolNotification(type, message) {
          const notification = document.getElementById("notification");
          notification.className = type; // error veya success
          notification.textContent = message;
          notification.classList.remove("hidden");

          // 3 saniye sonra bildirim kaybolsun
          setTimeout(() => {
            notification.classList.add("hidden");
          }, 3000);
        }

        // Yeni kayıt formu göster/gizle
        function toggleNewWordForm() {
          const formContainer = document.getElementById("newWordFormContainer");
          formContainer.classList.toggle("hidden");
        }

        // Yeni kayıt ekleme fonksiyonu
        async function saveNewWord() {
          try {
            // Form verilerini topla
            const newData = {
              en: document.getElementById("newEn").value,
              tr: document.getElementById("newTr").value,
              de: document.getElementById("newDe").value,
              fr: document.getElementById("newFr").value,
              it: document.getElementById("newIt").value,
              es: document.getElementById("newEs").value,
              pt: document.getElementById("newPt").value,
              nl: document.getElementById("newNl").value,
              pl: document.getElementById("newPl").value,
              se: document.getElementById("newSe").value,
              no: document.getElementById("newNo").value,
              dk: document.getElementById("newDk").value,
              fi: document.getElementById("newFi").value,
              ru: document.getElementById("newRu").value,
              ua: document.getElementById("newUa").value,
              ro: document.getElementById("newRo").value,
              gr: document.getElementById("newGr").value,
              hu: document.getElementById("newHu").value,
              cz: document.getElementById("newCz").value,
            };

            // API'ye gönder
            const response = await fetch(`${BASE_URL}/alkol-maddeleri`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(newData),
            });

            if (!response.ok) {
              throw new Error("Yeni kayıt eklenirken bir hata oluştu");
            }

            // Başarı mesajı göster
            showAlkolNotification("success", "Yeni kayıt başarıyla eklendi");

            // Formu temizle ve gizle
            clearNewWordForm();
            toggleNewWordForm();

            // Tabloyu yenile
            fetchAlkolData();
          } catch (error) {
            console.error("Yeni kayıt ekleme hatası:", error);
            showAlkolNotification("error", `Hata: ${error.message}`);
          }
        }

        // Yeni kayıt formunu temizle
        function clearNewWordForm() {
          const formInputs = document.querySelectorAll(
            ".new-word-form textarea"
          );
          formInputs.forEach((input) => {
            input.value = "";
          });
        }

        // Yeni kayıt ekleme butonuna tıklanınca
        document
          .getElementById("addNewWordBtn")
          ?.addEventListener("click", toggleNewWordForm);

        // Kaydet butonuna tıklanınca
        document
          .getElementById("saveNewWordBtn")
          ?.addEventListener("click", saveNewWord);

        // İptal butonuna tıklanınca
        document
          .getElementById("cancelNewWordBtn")
          ?.addEventListener("click", function () {
            clearNewWordForm();
            toggleNewWordForm();
          });

        // Sayfa yüklendiğinde verileri çek (hangi tab aktifse)
        if (
          document
            .querySelector('.tab[data-tab="tab1"]')
            .classList.contains("active")
        ) {
          fetchAndFillData();
        } else if (
          document
            .querySelector('.tab[data-tab="tab3"]')
            .classList.contains("active")
        ) {
          fetchTokenUsageData();
        }

        // Alt sekme değiştirildiğinde ilgili verileri çek
        document.querySelectorAll(".sub-tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            if (this.dataset.subtab === "subtab1") {
              fetchAlkolData();
            } else if (this.dataset.subtab === "subtab2") {
              fetchAssistantData();
            } else if (this.dataset.subtab === "subtab3") {
              fetchClassesData();
            } else if (this.dataset.subtab === "subtab4") {
              fetchBaseInstructionData();
            } else if (this.dataset.subtab === "subtab5") {
              fetchUsersData();
            }
          });
        });

        // Ana tab değiştirildiğinde, eğer Barcode Kelimeler tabı açıldıysa aktif alt tabın verilerini çek
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            if (this.dataset.tab === "tab2") {
              // Aktif alt tabı bul
              const activeSubTab = document.querySelector('.sub-tab.active');
              if (activeSubTab) {
                const subtabId = activeSubTab.dataset.subtab;
                if (subtabId === "subtab1") {
                  fetchAlkolData();
                } else if (subtabId === "subtab2") {
                  fetchAssistantData();
                } else if (subtabId === "subtab3") {
                  fetchClassesData();
                } else if (subtabId === "subtab4") {
                  fetchBaseInstructionData();
                } else if (subtabId === "subtab5") {
                  fetchUsersData();
                }
              }
            }
          });
        });

        // AI Asistanlar için fonksiyonlar
        async function fetchAssistantData() {
          try {
            const response = await fetch(`${BASE_URL}/assistants-ai`);
            if (!response.ok) {
              throw new Error("Asistan verileri alınamadı");
            }

            const data = await response.json();
            renderAssistantTable(data);
            document.getElementById("totalAssistants").textContent = data.length;
          } catch (error) {
            console.error("Asistan verileri çekme hatası:", error);
            showAssistantNotification("error", `Hata: ${error.message}`);
          }
        }

        function renderAssistantTable(data) {
          const tableBody = document.getElementById("assistantTableBody");
          if (!tableBody) return;

          if (data.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="7" class="no-data">Kayıtlı asistan bulunamadı</td>
              </tr>
            `;
            return;
          }

          tableBody.innerHTML = "";

          data.forEach((assistant) => {
            const row = document.createElement("tr");
            row.dataset.id = assistant.id;

            // İşlemler hücresi
            const actionsCell = document.createElement("td");
            actionsCell.className = "action-cell";
            actionsCell.innerHTML = `
              <div class="action-buttons">
                <button class="action-btn edit-btn" data-id="${assistant.id}">
                  <i class="material-icons">edit</i>
                </button>
                <button class="action-btn delete-btn" data-id="${assistant.id}">
                  <i class="material-icons">delete</i>
                </button>
              </div>
            `;

            // Asistan adı hücresi
            const nameCell = document.createElement("td");
            nameCell.textContent = assistant.name;
            nameCell.className = "name-cell";

            // Dil hücresi
            const languageCell = document.createElement("td");
            languageCell.textContent = assistant.language || "-";
            languageCell.className = "language-cell";

            // Talimatlar hücresi (kısaltılmış)
            const instructionCell = document.createElement("td");
            instructionCell.className = "instruction-cell";
            const instructionText = assistant.instruction || "";
            instructionCell.textContent = instructionText.length > 100 
              ? instructionText.substring(0, 100) + "..." 
              : instructionText;
            instructionCell.title = instructionText; // Tam metni tooltip olarak göster

            // Asistan ID hücresi
            const assistantIdCell = document.createElement("td");
            assistantIdCell.textContent = assistant.assistantId || "-";
            assistantIdCell.className = "assistant-id-cell";

            // Aktif hücresi
            const activeCell = document.createElement("td");
            activeCell.className = "active-cell";
            if (assistant.active === undefined) {
              // Eski kayıtlarda active field yoksa varsayılan olarak true kabul et
              activeCell.innerHTML = `<span class="status-badge active">Aktif</span>`;
            } else {
              activeCell.innerHTML = assistant.active ? 
                `<span class="status-badge active">Aktif</span>` : 
                `<span class="status-badge inactive">Pasif</span>`;
            }

            // Oluşturulma tarihi hücresi
            const createdAtCell = document.createElement("td");
            createdAtCell.textContent = new Date(assistant.createdAt).toLocaleString("tr-TR");
            createdAtCell.className = "date-cell";

            // Güncellenme tarihi hücresi
            const updatedAtCell = document.createElement("td");
            updatedAtCell.textContent = new Date(assistant.updatedAt).toLocaleString("tr-TR");
            updatedAtCell.className = "date-cell";

            // Hücreleri satıra ekle
            row.appendChild(actionsCell);
            row.appendChild(nameCell);
            row.appendChild(languageCell);
            row.appendChild(instructionCell);
            row.appendChild(assistantIdCell);
            row.appendChild(activeCell);
            row.appendChild(createdAtCell);
            row.appendChild(updatedAtCell);

            // Satırı tabloya ekle
            tableBody.appendChild(row);
          });

          // Düzenleme butonlarına olay dinleyicileri ekle
          document.querySelectorAll(".edit-btn").forEach((btn) => {
            btn.addEventListener("click", function() {
              const id = this.dataset.id;
              editAssistant(id);
            });
          });

          // Silme butonlarına olay dinleyicileri ekle
          document.querySelectorAll(".delete-btn").forEach((btn) => {
            btn.addEventListener("click", function() {
              const id = this.dataset.id;
              deleteAssistant(id);
            });
          });
        }

        // Asistan düzenleme fonksiyonu
        async function editAssistant(id) {
          try {
            const response = await fetch(`${BASE_URL}/assistants-ai/${id}`);
            if (!response.ok) {
              throw new Error("Asistan bilgileri alınamadı");
            }

            const assistant = await response.json();
            
            // Düzenleme formunu göster ve doldur
            document.getElementById("newAssistantFormContainer").classList.remove("hidden");
            document.getElementById("newAssistantName").value = assistant.name || "";
            document.getElementById("newAssistantLanguage").value = assistant.language || "";
            document.getElementById("newAssistantId").value = assistant.assistantId || "";
            document.getElementById("newAssistantInstruction").value = assistant.instruction || "";
            
            // Active checkbox'u ayarla
            const activeCheckbox = document.getElementById("newAssistantActive");
            if (assistant.active === undefined) {
              // Eski kayıtlarda active field yoksa varsayılan olarak true kabul et
              activeCheckbox.checked = true;
            } else {
              activeCheckbox.checked = assistant.active;
            }
            
            // Kaydet butonuna tıklandığında güncelleme yapacak şekilde ayarla
            const saveBtn = document.getElementById("saveNewAssistantBtn");
            saveBtn.dataset.mode = "edit";
            saveBtn.dataset.id = id;
            saveBtn.textContent = "Güncelle";
            
            // Başlığı güncelle
            const formTitle = document.querySelector("#newAssistantFormContainer .form-title");
            if (!formTitle) {
              const titleDiv = document.createElement("div");
              titleDiv.className = "form-title";
              titleDiv.textContent = "Asistan Düzenle";
              document.getElementById("newAssistantFormContainer").prepend(titleDiv);
            } else {
              formTitle.textContent = "Asistan Düzenle";
            }
          } catch (error) {
            console.error("Asistan düzenleme hatası:", error);
            showAssistantNotification("error", `Hata: ${error.message}`);
          }
        }

        // Asistan silme fonksiyonu
        async function deleteAssistant(id) {
          if (!confirm("Bu asistanı silmek istediğinize emin misiniz?")) {
            return;
          }

          try {
            const response = await fetch(`${BASE_URL}/assistants-ai/${id}`, {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
              },
            });

            if (!response.ok) {
              throw new Error("Asistan silinemedi");
            }

            showAssistantNotification("success", "Asistan başarıyla silindi");
            fetchAssistantData(); // Tabloyu yenile
          } catch (error) {
            console.error("Asistan silme hatası:", error);
            showAssistantNotification("error", `Hata: ${error.message}`);
          }
        }

        // Yeni asistan ekleme formunu göster/gizle
        function toggleNewAssistantForm() {
          const formContainer = document.getElementById("newAssistantFormContainer");
          formContainer.classList.toggle("hidden");

          // Eğer form gösteriliyorsa ve düzenleme modunda değilse
          if (!formContainer.classList.contains("hidden")) {
            const saveBtn = document.getElementById("saveNewAssistantBtn");
            if (saveBtn.dataset.mode !== "edit") {
              // Form başlığını ekle veya güncelle
              const formTitle = document.querySelector("#newAssistantFormContainer .form-title");
              if (!formTitle) {
                const titleDiv = document.createElement("div");
                titleDiv.className = "form-title";
                titleDiv.textContent = "Yeni Asistan Ekle";
                formContainer.prepend(titleDiv);
              } else {
                formTitle.textContent = "Yeni Asistan Ekle";
              }
            }
          }
        }

        // Yeni asistan ekleme veya mevcut asistanı güncelleme
        async function saveAssistant() {
          try {
            const saveBtn = document.getElementById("saveNewAssistantBtn");
            const isEditMode = saveBtn.dataset.mode === "edit";
            const id = saveBtn.dataset.id;

            // Form verilerini topla
            const assistantData = {
              name: document.getElementById("newAssistantName").value.trim(),
              language: document.getElementById("newAssistantLanguage").value.trim(),
              assistantId: document.getElementById("newAssistantId").value.trim(),
              instruction: document.getElementById("newAssistantInstruction").value.trim(),
              active: document.getElementById("newAssistantActive").checked,
            };

            // Zorunlu alanları kontrol et
            if (!assistantData.name) {
              throw new Error("Asistan adı zorunludur");
            }

            if (!assistantData.instruction) {
              throw new Error("Talimatlar zorunludur");
            }

            // API'ye gönder (ekleme veya güncelleme)
            const url = isEditMode 
              ? `${BASE_URL}/assistants-ai/${id}` 
              : `${BASE_URL}/assistants-ai`;
            
            const method = isEditMode ? "PATCH" : "POST";

            const response = await fetch(url, {
              method: method,
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(assistantData),
            });

            if (!response.ok) {
              throw new Error(isEditMode ? "Asistan güncellenemedi" : "Yeni asistan eklenemedi");
            }

            // Başarı mesajı göster
            showAssistantNotification(
              "success", 
              isEditMode ? "Asistan başarıyla güncellendi" : "Yeni asistan başarıyla eklendi"
            );

            // Formu temizle ve gizle
            clearAssistantForm();
            toggleNewAssistantForm();

            // Tabloyu yenile
            fetchAssistantData();
          } catch (error) {
            console.error("Asistan kaydetme hatası:", error);
            showAssistantNotification("error", `Hata: ${error.message}`);
          }
        }

        // Asistan formunu temizle
        function clearAssistantForm() {
          document.getElementById("newAssistantName").value = "";
          document.getElementById("newAssistantLanguage").value = "";
          document.getElementById("newAssistantId").value = "";
          document.getElementById("newAssistantInstruction").value = "";
          document.getElementById("newAssistantActive").checked = true; // Varsayılan olarak aktif
          
          // Kaydet butonunu sıfırla
          const saveBtn = document.getElementById("saveNewAssistantBtn");
          saveBtn.dataset.mode = "add";
          saveBtn.dataset.id = "";
          saveBtn.textContent = "Kaydet";
        }

        // Bildirim gösterme fonksiyonu
        function showAssistantNotification(type, message) {
          const notification = document.getElementById("assistantNotification");
          notification.textContent = message;
          notification.className = type === "success" ? "success" : "error";
          notification.classList.remove("hidden");
          
          // 3 saniye sonra bildirimi gizle
          setTimeout(() => {
            notification.classList.add("hidden");
          }, 3000);
        }

        // Yeni asistan ekleme butonuna tıklanınca
        document
          .getElementById("addNewAssistantBtn")
          ?.addEventListener("click", toggleNewAssistantForm);

        // Kaydet butonuna tıklanınca
        document
          .getElementById("saveNewAssistantBtn")
          ?.addEventListener("click", saveAssistant);

        // İptal butonuna tıklanınca
        document
          .getElementById("cancelNewAssistantBtn")
          ?.addEventListener("click", function () {
            clearAssistantForm();
            toggleNewAssistantForm();
          });

        // Sayfa yüklendiğinde verileri çek (hangi tab aktifse)
        if (
          document
            .querySelector('.tab[data-tab="tab1"]')
            .classList.contains("active")
        ) {
          fetchAndFillData();
        } else if (
          document
            .querySelector('.tab[data-tab="tab3"]')
            .classList.contains("active")
        ) {
          fetchTokenUsageData();
        }
      });

      // Sınıflar için fonksiyonlar
      async function fetchClassesData() {
        try {
          const response = await fetch(`${BASE_URL}/classes`);
          if (!response.ok) {
            throw new Error("Sınıf verileri alınamadı");
          }

          const data = await response.json();
          renderClassTable(data);
          document.getElementById("totalClasses").textContent = data.length;
        } catch (error) {
          console.error("Sınıf verileri çekme hatası:", error);
          showClassNotification("error", `Hata: ${error.message}`);
        }
      }

      // Asistanları çekip dropdown menüye ekle
      async function fetchAssistantsForDropdown() {
        try {
          const response = await fetch(`${BASE_URL}/assistants-ai/active`);
          if (!response.ok) {
            throw new Error("Asistan verileri alınamadı");
          }

          const assistants = await response.json();
          const dropdown = document.getElementById("newClassAssistantId");
          
          // Dropdown'u temizle (ilk seçenek hariç)
          while (dropdown.options.length > 1) {
            dropdown.remove(1);
          }

          // Asistanları dropdown'a ekle
          assistants.forEach(assistant => {
            const option = document.createElement("option");
            option.value = assistant.id;
            option.textContent = `${assistant.name} (${assistant.language || 'Dil belirtilmedi'})`;  
            dropdown.appendChild(option);
          });

          return assistants;
        } catch (error) {
          console.error("Asistan verileri çekme hatası:", error);
          showClassNotification("error", `Hata: ${error.message}`);
          return [];
        }
      }

      // Asistan adını ID'ye göre bul
      function findAssistantNameById(assistants, assistantId) {
        const assistant = assistants.find(a => a.id === assistantId);
        return assistant ? `${assistant.name} (${assistant.language || 'Dil belirtilmedi'})` : 'Asistan bulunamadı';
      }

      // Sınıf tablosunu oluştur
      async function renderClassTable(classes) {
        const tableBody = document.getElementById("classTableBody");
        if (!tableBody) return;

        if (classes.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="8" class="no-data">Kayıtlı sınıf bulunamadı</td>
            </tr>
          `;
          return;
        }

        // Tüm asistanları çek
        const assistants = await fetchAssistantsForDropdown();

        tableBody.innerHTML = "";

        classes.forEach((classItem) => {
          const row = document.createElement("tr");
          row.dataset.id = classItem.id;

          // İşlemler hücresi
          const actionsCell = document.createElement("td");
          actionsCell.className = "action-cell";
          actionsCell.innerHTML = `
            <div class="action-buttons">
              <button class="action-btn edit-class-btn" data-id="${classItem.id}">
                <i class="material-icons">edit</i>
              </button>
              <button class="action-btn delete-class-btn" data-id="${classItem.id}">
                <i class="material-icons">delete</i>
              </button>
            </div>
          `;

          // İkon hücresi
          const iconCell = document.createElement("td");
          iconCell.className = "icon-cell";
          if (classItem.icon) {
            iconCell.innerHTML = `<img src="data:image/png;base64,${classItem.icon}" style="width: 100px; height: 100px; object-fit: contain;" alt="${classItem.name} ikonu">`;
          } else {
            iconCell.innerHTML = `<div style="width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; border: 1px dashed #ccc;"><i class="material-icons">image_not_supported</i></div>`;
          }

          // Sınıf adı hücresi
          const nameCell = document.createElement("td");
          nameCell.textContent = classItem.name;
          nameCell.className = "name-cell";

          // Açıklama hücresi
          const descriptionCell = document.createElement("td");
          descriptionCell.textContent = classItem.description || "-";
          descriptionCell.className = "description-cell";

          // Talimatlar hücresi (kısaltılmış)
          const instructionCell = document.createElement("td");
          instructionCell.className = "instruction-cell";
          const instructionText = classItem.instruction || "";
          instructionCell.textContent = instructionText.length > 100 
            ? instructionText.substring(0, 100) + "..." 
            : instructionText;
          instructionCell.title = instructionText; // Tam metni tooltip olarak göster

          // Asistan hücresi
          const assistantCell = document.createElement("td");
          assistantCell.textContent = classItem.assistantId ? 
            findAssistantNameById(assistants, classItem.assistantId) : "-";
          assistantCell.className = "assistant-cell";

          // Oluşturulma tarihi hücresi
          const createdAtCell = document.createElement("td");
          createdAtCell.textContent = new Date(classItem.createdAt).toLocaleString("tr-TR");
          createdAtCell.className = "date-cell";

          // Güncellenme tarihi hücresi
          const updatedAtCell = document.createElement("td");
          updatedAtCell.textContent = new Date(classItem.updatedAt).toLocaleString("tr-TR");
          updatedAtCell.className = "date-cell";

          // Hücreleri satıra ekle
          row.appendChild(actionsCell);
          row.appendChild(iconCell);
          row.appendChild(nameCell);
          row.appendChild(descriptionCell);
          row.appendChild(instructionCell);
          row.appendChild(assistantCell);
          row.appendChild(createdAtCell);
          row.appendChild(updatedAtCell);

          // Satırı tabloya ekle
          tableBody.appendChild(row);
        });

        // Düzenleme butonlarına olay dinleyicileri ekle
        document.querySelectorAll(".edit-class-btn").forEach((btn) => {
          btn.addEventListener("click", function() {
            const id = this.dataset.id;
            editClass(id);
          });
        });

        // Silme butonlarına olay dinleyicileri ekle
        document.querySelectorAll(".delete-class-btn").forEach((btn) => {
          btn.addEventListener("click", function() {
            const id = this.dataset.id;
            deleteClass(id);
          });
        });
      }

      // Sınıf düzenleme fonksiyonu
      async function editClass(id) {
        try {
          const response = await fetch(`${BASE_URL}/classes/${id}`);
          if (!response.ok) {
            throw new Error("Sınıf bilgileri alınamadı");
          }

          const classItem = await response.json();
          
          // Asistanları çek ve dropdown'a ekle
          await fetchAssistantsForDropdown();
          
          // Düzenleme formunu göster ve doldur
          document.getElementById("newClassFormContainer").classList.remove("hidden");
          document.getElementById("newClassName").value = classItem.name || "";
          document.getElementById("newClassDescription").value = classItem.description || "";
          document.getElementById("newClassInstruction").value = classItem.instruction || "";
          
          // İkon varsa göster
          if (classItem.icon) {
            document.getElementById("iconPreview").src = `data:image/png;base64,${classItem.icon}`;
            document.getElementById("iconPreview").style.display = "block";
            document.getElementById("noIconText").style.display = "none";
          } else {
            document.getElementById("iconPreview").style.display = "none";
            document.getElementById("noIconText").style.display = "block";
          }
          
          // Asistan seçimini ayarla
          const assistantDropdown = document.getElementById("newClassAssistantId");
          if (classItem.assistantId) {
            for (let i = 0; i < assistantDropdown.options.length; i++) {
              if (assistantDropdown.options[i].value === classItem.assistantId) {
                assistantDropdown.selectedIndex = i;
                break;
              }
            }
          } else {
            assistantDropdown.selectedIndex = 0;
          }
          
          // Kaydet butonuna tıklandığında güncelleme yapacak şekilde ayarla
          const saveBtn = document.getElementById("saveNewClassBtn");
          saveBtn.dataset.mode = "edit";
          saveBtn.dataset.id = id;
          saveBtn.textContent = "Güncelle";
          
          // Başlığı güncelle
          const formTitle = document.querySelector("#newClassFormContainer .form-title");
          if (!formTitle) {
            const titleDiv = document.createElement("div");
            titleDiv.className = "form-title";
            titleDiv.textContent = "Sınıf Düzenle";
            document.getElementById("newClassFormContainer").prepend(titleDiv);
          } else {
            formTitle.textContent = "Sınıf Düzenle";
          }
        } catch (error) {
          console.error("Sınıf düzenleme hatası:", error);
          showClassNotification("error", `Hata: ${error.message}`);
        }
      }

      // Sınıf silme fonksiyonu
      async function deleteClass(id) {
        if (!confirm("Bu sınıfı silmek istediğinize emin misiniz?")) {
          return;
        }

        try {
          const response = await fetch(`${BASE_URL}/classes/${id}`, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
          });

          if (!response.ok) {
            throw new Error("Sınıf silinemedi");
          }

          showClassNotification("success", "Sınıf başarıyla silindi");
          fetchClassesData(); // Tabloyu yenile
        } catch (error) {
          console.error("Sınıf silme hatası:", error);
          showClassNotification("error", `Hata: ${error.message}`);
        }
      }

      // Yeni sınıf ekleme formunu göster/gizle
      async function toggleNewClassForm() {
        const formContainer = document.getElementById("newClassFormContainer");
        
        // Form gösterilecekse ve gizliyse
        if (formContainer.classList.contains("hidden")) {
          // Önce asistanları çek
          await fetchAssistantsForDropdown();
          formContainer.classList.remove("hidden");
          
          // Form başlığını ekle veya güncelle
          const saveBtn = document.getElementById("saveNewClassBtn");
          if (saveBtn.dataset.mode !== "edit") {
            const formTitle = document.querySelector("#newClassFormContainer .form-title");
            if (!formTitle) {
              const titleDiv = document.createElement("div");
              titleDiv.className = "form-title";
              titleDiv.textContent = "Yeni Sınıf Ekle";
              formContainer.prepend(titleDiv);
            } else {
              formTitle.textContent = "Yeni Sınıf Ekle";
            }
          }
        } else {
          // Formu gizle
          formContainer.classList.add("hidden");
        }
      }

      // Yeni sınıf ekleme veya mevcut sınıfı güncelleme
      async function saveClass() {
        try {
          const saveBtn = document.getElementById("saveNewClassBtn");
          const isEditMode = saveBtn.dataset.mode === "edit";
          const id = saveBtn.dataset.id;

          // Form verilerini topla
          const classData = {
            name: document.getElementById("newClassName").value.trim(),
            description: document.getElementById("newClassDescription").value.trim(),
            instruction: document.getElementById("newClassInstruction").value.trim(),
            assistantId: document.getElementById("newClassAssistantId").value,
            icon: document.getElementById("iconPreview").src && document.getElementById("iconPreview").style.display !== "none" ? 
              document.getElementById("iconPreview").src.split(",")[1] : null, // Base64 formatında resim verisi
          };

          // Zorunlu alanları kontrol et
          if (!classData.name) {
            throw new Error("Sınıf adı zorunludur");
          }

          if (!classData.instruction) {
            throw new Error("Talimatlar zorunludur");
          }
          
          if (!classData.description) {
            throw new Error("Açıklama zorunludur");
          }

          if (!classData.assistantId) {
            throw new Error("Bir asistan seçmelisiniz");
          }

          // API'ye gönder (ekleme veya güncelleme)
          const url = isEditMode 
            ? `${BASE_URL}/classes/${id}` 
            : `${BASE_URL}/classes`;
          
          const method = isEditMode ? "PATCH" : "POST";

          const response = await fetch(url, {
            method: method,
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(classData),
          });

          if (!response.ok) {
            throw new Error(isEditMode ? "Sınıf güncellenemedi" : "Yeni sınıf eklenemedi");
          }

          // Başarı mesajı göster
          showClassNotification(
            "success", 
            isEditMode ? "Sınıf başarıyla güncellendi" : "Yeni sınıf başarıyla eklendi"
          );

          // Formu temizle ve gizle
          clearClassForm();
          toggleNewClassForm();

          // Tabloyu yenile
          fetchClassesData();
        } catch (error) {
          console.error("Sınıf kaydetme hatası:", error);
          showClassNotification("error", `Hata: ${error.message}`);
        }
      }

      // Sınıf formunu temizle
      function clearClassForm() {
        document.getElementById("newClassName").value = "";
        document.getElementById("newClassDescription").value = "";
        document.getElementById("newClassInstruction").value = "";
        document.getElementById("newClassAssistantId").selectedIndex = 0;
        
        // İkon önizlemeyi temizle
        document.getElementById("iconPreview").src = "";
        document.getElementById("iconPreview").style.display = "none";
        document.getElementById("noIconText").style.display = "block";
        document.getElementById("newClassIcon").value = "";
        
        // Kaydet butonunu sıfırla
        const saveBtn = document.getElementById("saveNewClassBtn");
        saveBtn.dataset.mode = "add";
        saveBtn.dataset.id = "";
        saveBtn.textContent = "Kaydet";
      }

      // Bildirim gösterme fonksiyonu
      function showClassNotification(type, message) {
        const notification = document.getElementById("classNotification");
        notification.textContent = message;
        notification.className = type === "success" ? "success" : "error";
        notification.classList.remove("hidden");
        
        // 3 saniye sonra bildirimi gizle
        setTimeout(() => {
          notification.classList.add("hidden");
        }, 3000);
      }

      // Yeni sınıf ekleme butonuna tıklanınca
      document
        .getElementById("addNewClassBtn")
        ?.addEventListener("click", toggleNewClassForm);

      // Kaydet butonuna tıklanınca
      document
        .getElementById("saveNewClassBtn")
        ?.addEventListener("click", saveClass);

      // İptal butonuna tıklanınca
      document
        .getElementById("cancelNewClassBtn")
        ?.addEventListener("click", function () {
          clearClassForm();
          toggleNewClassForm();
        });
        
      // Resim yükleme işlevi
      document.getElementById("newClassIcon")?.addEventListener("change", function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        // Sadece resim dosyalarını kabul et
        if (!file.type.match('image.*')) {
          alert('Lütfen bir resim dosyası seçin');
          return;
        }
        
        // Dosya boyutunu kontrol et (max 2MB)
        if (file.size > 2 * 1024 * 1024) {
          alert('Resim dosyası 2MB\'dan küçük olmalıdır');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          const imgPreview = document.getElementById("iconPreview");
          imgPreview.src = e.target.result;
          imgPreview.style.display = "block";
          document.getElementById("noIconText").style.display = "none";
        };
        reader.readAsDataURL(file);
      });

      // Base Instruction için fonksiyonlar
      // Aktif kod değerini saklayacak değişken
      let currentBaseCode = "BaseCodeGrammer";
      
      async function fetchBaseInstructionData() {
        try {
          // Değişken kod değeri ile endpoint'e istek yap
          const response = await fetch(`${BASE_URL}/base-instruction/find/by-code/${currentBaseCode}`);
          if (!response.ok) {
            throw new Error("Temel talimat verileri alınamadı");
          }

          const data = await response.json();
          displayBaseInstructionData(data);
          
          // Aktif butonu vurgula
          document.querySelectorAll('#baseCodeGrammerBtn, #baseCodeVoiceBtn').forEach(btn => {
            if (btn.dataset.code === currentBaseCode) {
              btn.style.backgroundColor = '#007bff';
            } else {
              btn.style.backgroundColor = '#6c757d';
            }
          });
        } catch (error) {
          console.error("Temel talimat verileri çekme hatası:", error);
          showBaseInstructionNotification("error", `Hata: ${error.message}`);
        }
      }

      // Temel talimat verilerini görüntüle
      function displayBaseInstructionData(data) {
        // Son güncelleme tarihini göster
        const lastUpdateEl = document.getElementById("baseInstructionLastUpdate");
        if (data.updatedAt) {
          lastUpdateEl.textContent = new Date(data.updatedAt).toLocaleString("tr-TR");
        } else {
          lastUpdateEl.textContent = "-";
        }

        // Detay görünümünü doldur
        document.getElementById("baseInstructionCodeValue").textContent = data.code || "-";
        document.getElementById("baseInstructionDescriptionValue").textContent = data.description || "-";
        document.getElementById("baseInstructionContentValue").textContent = data.baseInstruction || "-";

        // Form alanlarını da doldur (düzenleme için)
        document.getElementById("baseInstructionCode").value = data.code || "";
        document.getElementById("baseInstructionDescription").value = data.description || "";
        document.getElementById("baseInstructionContent").value = data.baseInstruction || "";

        // Form için ID bilgisini sakla
        const saveBtn = document.getElementById("saveBaseInstructionBtn");
        saveBtn.dataset.id = data.id;
      }

      // Düzenle butonuna tıklandığında formu göster
      function toggleBaseInstructionForm() {
        const formContainer = document.getElementById("baseInstructionFormContainer");
        formContainer.classList.toggle("hidden");
      }

      // Temel talimatı güncelle
      async function saveBaseInstruction() {
        try {
          const id = document.getElementById("saveBaseInstructionBtn").dataset.id;
          if (!id) {
            throw new Error("Güncellenecek temel talimat bulunamadı");
          }

          // Form verilerini topla
          const baseInstructionData = {
            code: document.getElementById("baseInstructionCode").value.trim(),
            description: document.getElementById("baseInstructionDescription").value.trim(),
            baseInstruction: document.getElementById("baseInstructionContent").value.trim(),
          };

          // Zorunlu alanları kontrol et
          if (!baseInstructionData.code) {
            throw new Error("Kod alanı zorunludur");
          }

          if (!baseInstructionData.baseInstruction) {
            throw new Error("Temel talimat alanı zorunludur");
          }

          // API'ye gönder (güncelleme)
          const response = await fetch(`${BASE_URL}/base-instruction/${id}`, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(baseInstructionData),
          });

          if (!response.ok) {
            throw new Error("Temel talimat güncellenemedi");
          }

          // Başarı mesajı göster
          showBaseInstructionNotification("success", "Temel talimat başarıyla güncellendi");

          // Formu gizle ve verileri yenile
          toggleBaseInstructionForm();
          fetchBaseInstructionData();
        } catch (error) {
          console.error("Temel talimat güncelleme hatası:", error);
          showBaseInstructionNotification("error", `Hata: ${error.message}`);
        }
      }

      // Bildirim gösterme fonksiyonu
      function showBaseInstructionNotification(type, message) {
        const notification = document.getElementById("baseInstructionNotification");
        notification.textContent = message;
        notification.className = type === "success" ? "success" : "error";
        notification.classList.remove("hidden");
        
        // 3 saniye sonra bildirimi gizle
        setTimeout(() => {
          notification.classList.add("hidden");
        }, 3000);
      }

      // Düzenle butonuna tıklanınca
      document
        .getElementById("editBaseInstructionBtn")
        ?.addEventListener("click", toggleBaseInstructionForm);
        
      // Gramer Talimatı butonuna tıklanınca
      document
        .getElementById("baseCodeGrammerBtn")
        ?.addEventListener("click", function() {
          currentBaseCode = "BaseCodeGrammer";
          fetchBaseInstructionData();
        });
        
      // Ses Talimatı butonuna tıklanınca
      document
        .getElementById("baseCodeVoiceBtn")
        ?.addEventListener("click", function() {
          currentBaseCode = "BaseCodeVoice";
          fetchBaseInstructionData();
        });

      // Güncelle butonuna tıklanınca
      document
        .getElementById("saveBaseInstructionBtn")
        ?.addEventListener("click", saveBaseInstruction);

      // İptal butonuna tıklanınca
      document
        .getElementById("cancelBaseInstructionBtn")
        ?.addEventListener("click", toggleBaseInstructionForm);

      // Kullanıcı yönetimi için fonksiyonlar
      async function fetchUsersData() {
        try {
          const response = await fetch(`${BASE_URL}/users`);
          if (!response.ok) {
            throw new Error("Kullanıcı verileri alınamadı");
          }

          const data = await response.json();
          renderUsersTable(data);
          document.getElementById("totalUsers").textContent = data.length;
        } catch (error) {
          console.error("Kullanıcı verileri çekme hatası:", error);
          showUsersNotification("error", `Hata: ${error.message}`);
        }
      }

      // Token kullanım verileri için fonksiyonlar
      async function fetchTokenUsageData() {
        try {
          // Önce tüm yükleniyor yazılarını sıfır olarak göster
          document.getElementById("totalTokenSum").textContent = "0";
          document.getElementById("totalCheckCallSum").textContent = "0";
          document.getElementById("totalTokenCountOpenAiHelalControl").textContent = "0";
          document.getElementById("totalTokenCountAnthropicHelalControl").textContent = "0";
          document.getElementById("totalTokenCountOpenAiLernenAi").textContent = "0";
          document.getElementById("totalTokenCountAnthropicLernenAi").textContent = "0";
          document.getElementById("checkCallCount").textContent = "0";
          document.getElementById("checkCallCountLernenAi").textContent = "0";
          
          const response = await fetch(`${BASE_URL}/used-stor`);
          if (!response.ok) {
            throw new Error("Token kullanım verileri alınamadı");
          }

          const data = await response.json();
          if (data && data.length > 0) {
            // En son kaydı al
            const latestData = data[0];
            
            // Toplam token sayısını göster
            document.getElementById("totalTokenSum").textContent = latestData.totalTokenCount.toLocaleString();
            
            // Detaylı token sayılarını göster
            document.getElementById("totalTokenCountOpenAiHelalControl").textContent = 
              latestData.totalTokenCountOpenAiHelalControl.toLocaleString();
            document.getElementById("totalTokenCountAnthropicHelalControl").textContent = 
              latestData.totalTokenCountAnthropicHelalControl.toLocaleString();
            document.getElementById("totalTokenCountOpenAiLernenAi").textContent = 
              latestData.totalTokenCountOpenAiLernenAi.toLocaleString();
            document.getElementById("totalTokenCountAnthropicLernenAi").textContent = 
              latestData.totalTokenCountAnthropicLernenAi.toLocaleString();
            
            // Kontrol sayılarını göster
            document.getElementById("totalCheckCallSum").textContent = 
              (latestData.checkCallCount + latestData.checkCallCountLernenAi).toLocaleString();
            document.getElementById("checkCallCount").textContent = 
              latestData.checkCallCount.toLocaleString();
            document.getElementById("checkCallCountLernenAi").textContent = 
              latestData.checkCallCountLernenAi.toLocaleString();
            
            // Tabloyu doldur
            renderTokenTable(data);
            
            // Grafik için veri hazırla ve çiz (isteğe bağlı)
            // prepareAndDrawChart(data);
          } else {
            document.getElementById("tokenTableBody").innerHTML = `
              <tr>
                <td colspan="8" class="no-data">Kayıtlı token kullanım verisi bulunamadı</td>
              </tr>
            `;
          }
        } catch (error) {
          console.error("Token kullanım verileri çekme hatası:", error);
          document.getElementById("tokenTableBody").innerHTML = `
            <tr>
              <td colspan="8" class="error-message">Hata: ${error.message}</td>
            </tr>
          `;
        }
      }

      // Token tablosunu oluştur
      function renderTokenTable(data) {
        const tableBody = document.getElementById("tokenTableBody");
        if (!tableBody) return;

        if (!Array.isArray(data) || data.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="8" class="no-data">Kayıtlı token kullanım verisi bulunamadı</td>
            </tr>
          `;
          return;
        }

        tableBody.innerHTML = "";

        // Son 10 kaydı göster (en yeniden en eskiye)
        const recentData = data.slice(0, 10);

        recentData.forEach((item) => {
          const row = document.createElement("tr");

          // Yardımcı fonksiyonlar
          const createCell = (value, className) => {
            const cell = document.createElement("td");
            cell.textContent = typeof value === 'number' ? value.toLocaleString('tr-TR') : value;
            cell.className = className;
            return cell;
          };

          // Tarih hücresi
          const date = new Date(item.createdAt);
          const formattedDate = date.toLocaleDateString("tr-TR", {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
          });

          // Hücreler
          const cells = [
            createCell(formattedDate, "date-cell"),
            createCell((
              (item.totalTokenCountOpenAiHelalControl || 0) +
              (item.totalTokenCountAnthropicHelalControl || 0) +
              (item.totalTokenCountOpenAiLernenAi || 0) +
              (item.totalTokenCountAnthropicLernenAi || 0)
            ), "token-cell"),
            createCell(item.totalTokenCountOpenAiHelalControl || 0, "token-cell"),
            createCell(item.totalTokenCountAnthropicHelalControl || 0, "token-cell"),
            createCell(item.totalTokenCountOpenAiLernenAi || 0, "token-cell"),
            createCell(item.totalTokenCountAnthropicLernenAi || 0, "token-cell"),
            createCell(item.checkCallCount || 0, "call-cell"),
            createCell(item.checkCallCountLernenAi || 0, "call-cell")
          ];

          // Hücreleri satıra ekle
          cells.forEach(cell => row.appendChild(cell));

          // Satırı tabloya ekle
          tableBody.appendChild(row);
          // Satırı tabloya ekle
          tableBody.appendChild(row);
const lernenOpenAiCell = createTokenCell(item.totalTokenCountOpenAiLernenAi);

// Lernen AI Anthropic token hücresi
const lernenAnthropicCell = createTokenCell(item.totalTokenCountAnthropicLernenAi);

// Çağrı sayıları için hücreler
const createCallCell = (value) => {
const cell = document.createElement("td");
cell.textContent = value.toLocaleString();
cell.className = "call-cell";
return cell;
};

// Helal Kontrol çağrı sayısı hücresi
const helalCallCell = createCallCell(item.checkCallCount);

// Lernen AI çağrı sayısı hücresi
const lernenCallCell = createCallCell(item.checkCallCountLernenAi);
          row.appendChild(lernenOpenAiCell);
          row.appendChild(lernenAnthropicCell);
          row.appendChild(helalCallCell);
          row.appendChild(lernenCallCell);

          // Satırı tabloya ekle
          tableBody.appendChild(row);
        });
      }

      // Kullanıcı tablosunu oluştur
      function renderUsersTable(users) {
        const tableBody = document.getElementById("usersTableBody");
        if (!tableBody) return;

        if (users.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="5" class="no-data">Kayıtlı kullanıcı bulunamadı</td>
            </tr>
          `;
          return;
        }

        tableBody.innerHTML = "";

        users.forEach((user) => {
          const row = document.createElement("tr");
          
          // Kullanıcı adı hücresi
          const nameCell = document.createElement("td");
          nameCell.textContent = user.name || "-";
          nameCell.className = "name-cell";

          // E-posta hücresi
          const emailCell = document.createElement("td");
          emailCell.textContent = user.email || "-";
          emailCell.className = "email-cell";

          // Kullanıcı kodu hücresi
          const userCodeCell = document.createElement("td");
          userCodeCell.textContent = user.userCode || "-";
          userCodeCell.className = "user-code-cell";

          // Oluşturulma tarihi hücresi
          const createdAtCell = document.createElement("td");
          createdAtCell.textContent = new Date(user.createdAt).toLocaleString("tr-TR");
          createdAtCell.className = "date-cell";

          // Güncellenme tarihi hücresi
          const updatedAtCell = document.createElement("td");
          updatedAtCell.textContent = new Date(user.updatedAt).toLocaleString("tr-TR");
          updatedAtCell.className = "date-cell";

          // Hücreleri satıra ekle
          row.appendChild(nameCell);
          row.appendChild(emailCell);
          row.appendChild(userCodeCell);
          row.appendChild(createdAtCell);
          row.appendChild(updatedAtCell);

          // Satırı tabloya ekle
          tableBody.appendChild(row);
        });
      }

      // Bildirim gösterme fonksiyonu
      function showUsersNotification(type, message) {
        const notification = document.getElementById("usersNotification");
        notification.textContent = message;
        notification.className = type === "success" ? "success" : "error";
        notification.classList.remove("hidden");
        
        // 3 saniye sonra bildirimi gizle
        setTimeout(() => {
          notification.classList.add("hidden");
        }, 3000);
      }
    </script>
  </body>
</html>
